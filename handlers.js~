const prov = require("./provider.js");

const handleSinglePainting = (provider,app) => {
    app.get("/api/painting/:id", (req,resp) => {
	const p = prov.getPaintings();
	const findPainting = p.find(item => item.paintingID == req.params.id);
	resp.json(findPainting);
    });
};

const handleAllPaintings = (provider,app) => {
    app.get("/api/paintings", (req,resp) => {
	resp.json(prov.getPaintings());
    });
};

const handleGalleryID = (provider,app) => {
    app.get("/api/painting/gallery/:id", (req,resp) => {
	const g = prov.getGalleries();
	const GalleryData = g.filter(item => item.GalleryID == req.params.id);
	resp.json(GalleryData);
    });
};

const handleArtistID = (provider,app) => {
    app.get("/api/painting/artist/:id", (req,resp) => {
	const a = prov.getArtists()
	const ArtistData = a.filter(item => item.ArtistID == req.params.id);
	resp.json(ArtistData);
    });
};

const handleYearRange = (provider,app) => {
    app.get("/api/painting/year/:min/:max", (req,resp) => {
	const p = prov.getPaintings();
	const lowerSet = p.filter(item => (item.yearOfWork >= req.params.min));
	const upperSet = lowerSet.filter(item => (item.yearOfWork <= req.params.max));
	console.log(upperSet);
	resp.json(upperSet);
    });
};

const handleTitleSearch = (provider,app) => {
    app.get("/api/painting/title/:text", (req,resp) => {
	const p = prov.getPaintings();
	const Titles = p.filter(item => item.title.toLowerCase().includes(req.params.text.toLowerCase()));
	resp.json(Titles);
    });
};

const handleColorSearch = (provider,app) => {
// /api/painting/color/name - Returns JSON for the paintings that have a
//                            color that matches the provided hex value. Each
//                            painting has a dominantColors array with the
//                            six most common colors in the painting; each of
//                            these color values comes with a property named
//                            name that contains the name for that color.
//                            This should be case-insensitive.    
    app.get("/api/painting/color/:name", (req,resp) => {
	const p = prov.getPaintings();
/*	for (let temp of p) {
	    let dc = temp.details.annotation.dominantColors['web'];
	    //const Colors = dc.filter(item => item.web == req.params.name);
	    //let wc = dc['web'];
	    console.log(dc);
	    }*/
	const Colors = p.filter(item => item.details.annotation.dominantColors.web == req.params.name);
	resp.json(Colors);
    });
};
const handleArtists = (provider,app) => {
    app.get("/api/artists", (req,resp) => {
	resp.json(prov.getArtists());
    });
};
const handleArtistCountrySearch = (provider,app) => {
    app.get("/api/artists/:country", (req,resp) => {
	const a = prov.getArtists();
	const ArtistCountries = a.filter(item => item.Nationality.toLowerCase() == req.params.country.toLowerCase());
	resp.json(ArtistCountries);
    });
};

const handleGalleries = (provider,app) => {
    app.get("/api/galleries", (req,resp) => {
	resp.json(prov.getGalleries());
    });
};
const handleGalleryCountrySearch = (provider,app) => {
    app.get("/api/galleries/:country", (req,resp) => {
	const g = prov.getGalleries();
	const GalleryCountries = g.filter(item => item.GalleryCountry.toLowerCase() == req.params.country.toLowerCase());
	resp.json(GalleryCountries);
    });
};

module.exports = { handleAllPaintings, handleSinglePainting, handleGalleryID, handleArtistID, handleYearRange, handleTitleSearch, handleColorSearch, handleArtists, handleArtistCountrySearch, handleGalleries, handleGalleryCountrySearch };
